{% extends 'base.html' %}
{% block content %}
<h1 class="h4 fw-bold mb-1 d-flex align-items-center gap-2">
    <span class="material-icons" style="color:#1a1a1a">people</span> HR Dashboard
</h1>
<p class="text-muted mb-4">Welcome, <strong>{{ session.username }}</strong>. Accessing personnel management suite.</p>

<div class="row g-3 mb-4">
    {% for icon, color, label, val, unit in [
    ('people','#333333','Employees', stats.employees, 'People'),
    ('business','#333333','Departments', stats.departments, 'Units'),
    ('account_tree','#333333','Positions', stats.positions, 'Titles'),
    ('event_available', '#333333', 'Attendance', stats.attendance, 'Records'),
    ('star', '#333333', 'Bonus Points', stats.bonus_points, 'Awards'),
    ('emoji_events', '#333333', 'Yearly Bonus', stats.yearly_bonus, 'Reports'),
    ('warning','#333333','Penalties', stats.penalties, 'Cases'),
    ('description', '#333333', 'BP Log', stats.bp_log, 'Entries'),
    ('manage_accounts','#333333','Total Users', stats.users, 'Users'),
    ('badge','#333333','Total Roles', stats.roles, 'Roles'),
    ] %}
    <div class="col-6 col-md-4 col-xl-3">
        <div class="card border-0 shadow-sm">
            <div class="card-body d-flex align-items-center gap-3">
                <div class="rounded-3 p-2" style="background:{{ color }}22">
                    <span class="material-icons" style="color:{{ color }};font-size:28px">{{ icon }}</span>
                </div>
                <div>
                    <div class="text-muted"
                        style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.05em">{{ label }}
                    </div>
                    <div class="d-flex align-items-baseline gap-1">
                        <div class="fw-bold" style="font-size:26px">{{ val }}</div>
                        <div class="text-muted small" style="font-size:12px">{{ unit }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div class="row g-3">
    <div class="col-12">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-bottom fw-semibold">Personnel Distribution</div>
            <div class="card-body">
                <div style="position:relative;min-height:220px"><canvas id="deptChartHR"></canvas></div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    (function () {
        var ctx = document.getElementById('deptChartHR'); if (!ctx) return;
        var d = {{ dept_data| tojson | safe
    }};
    new Chart(ctx, { type: 'pie', data: { labels: d.map(x => x.department_name), datasets: [{ data: d.map(x => x.emp_count), backgroundColor: ['#111111', '#333333', '#555555', '#777777', '#999999', '#bbbbbb'], borderWidth: 2, borderColor: '#fff' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { boxWidth: 14, font: { size: 12 } } } } } });
}) ();
</script>
{% endblock %}
{% endblock %}