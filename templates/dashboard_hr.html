{% extends 'base.html' %}
{% block content %}
<h1 class="h4 fw-bold mb-1 d-flex align-items-center gap-2">
    <span class="material-icons" style="color:#1a1a1a">people</span> HR Dashboard
</h1>
<p class="text-muted mb-4">Welcome, <strong>{{ session.username }}</strong>. Accessing personnel management suite.</p>

<div class="row g-3 mb-4">
    {% for icon, color, label, val in [
    ('people','#333333','Employees', stats.employees),
    ('business','#333333','Departments', stats.departments),
    ('account_tree','#333333','Positions', stats.positions),
    ('warning','#333333','Penalties', stats.penalties),
    ] %}
    <div class="col-6 col-xl-3">
        <div class="card border-0 shadow-sm">
            <div class="card-body d-flex align-items-center gap-3">
                <div class="rounded-3 p-2" style="background:{{ color }}22">
                    <span class="material-icons" style="color:{{ color }};font-size:28px">{{ icon }}</span>
                </div>
                <div>
                    <div class="text-muted"
                        style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.05em">{{ label }}
                    </div>
                    <div class="fw-bold" style="font-size:26px">{{ val }}</div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div class="row g-3">
    <div class="col-12 col-xl-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-bottom fw-semibold">Management Modules</div>
            <div class="card-body">
                <div class="row g-2">
                    {% for ep, icon, label in [
                    ('employees.list_employees','people','Employees'),
                    ('departments.list_departments','business','Departments'),
                    ('positions.list_positions','account_tree','Positions'),
                    ('attendance.list_attendance','event_available','Attendance'),
                    ('bonus_points.list_bonus_points','star','Bonus Points'),
                    ('yearly_bonus.list_yearly_bonus','emoji_events','Yearly Bonus'),
                    ('penalties.list_penalties','warning','Penalties'),
                    ('bp.list_bp','description','B&P Log'),
                    ] %}
                    <div class="col-6">
                        <a href="{{ url_for(ep) }}"
                            class="btn btn-outline-secondary btn-sm w-100 text-start d-flex align-items-center gap-2">
                            <span class="material-icons-outlined" style="font-size:18px;color:#1a1a1a">{{ icon }}</span>
                            {{ label }}
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-xl-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-bottom fw-semibold">Personnel Distribution</div>
            <div class="card-body">
                <div style="position:relative;min-height:220px"><canvas id="deptChartHR"></canvas></div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    (function () {
        var ctx = document.getElementById('deptChartHR'); if (!ctx) return;
        var d = {{ dept_data| tojson | safe
    }};
    new Chart(ctx, { type: 'pie', data: { labels: d.map(x => x.department_name), datasets: [{ data: d.map(x => x.emp_count), backgroundColor: ['#111111', '#333333', '#555555', '#777777', '#999999', '#bbbbbb'], borderWidth: 2, borderColor: '#fff' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { boxWidth: 14, font: { size: 12 } } } } } });
}) ();
</script>
{% endblock %}
{% endblock %}